<div class="d-flex justify-content-between mb-3">
  <h3>Users</h3>
  <button class="btn btn-success" (click)="openAddUser()" *ngIf="permissions.canCreate">Add User</button>
</div>

<!-- Add/Edit Modal -->
<div class="modal" [class.show]="addUserModalVisible" [style.display]="addUserModalVisible ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEditing ? 'Edit User' : 'Add User' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form #userForm="ngForm">
          <div class="mb-2">
            <input type="text" [(ngModel)]="selectedUser.firstName" name="firstName" placeholder="First Name" class="form-control"/>
          </div>
          <div class="mb-2">
            <input type="text" [(ngModel)]="selectedUser.lastName" name="lastName" placeholder="Last Name" class="form-control"/>
          </div>
          <div class="mb-2">
            <input type="email" [(ngModel)]="selectedUser.email" name="email" placeholder="Email" class="form-control"/>
          </div>
          <div class="mb-2">
            <select class="form-select" [(ngModel)]="selectedUser.roleId" name="roleId" required>
              <option [value]="null">Select Role</option>
              <option *ngFor="let role of usersService.roles" [value]="role.id">{{ role.name }}</option>
            </select>
          </div>
          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-primary" (click)="saveUser()">{{ isEditing ? 'Update' : 'Add' }}</button>
            <button type="button" class="btn btn-secondary ms-2" (click)="closeModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Users Table -->
<table class="table table-striped mt-3">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of users">
      <td>{{ user.fullName }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.role.name }}</td>
      <td>
        <button class="btn btn-warning btn-sm" (click)="openEditUser(user)" *ngIf="permissions.canEdit">Edit</button>
        <button class="btn btn-danger btn-sm ms-2" (click)="deleteUser(user.id)" *ngIf="permissions.canDelete">Delete</button>
      </td>
    </tr>
  </tbody>
</table>
